<?phpnamespace app\admin\controller;use app\admin\model\News as NewsModel;use think\Request;class News extends Base{    /**     * 显示新闻列表页     */    public function index(Request $request)    {    	$keywords = $request->get('keywords');    	$model = new NewsModel;    	if ($keywords) {			$records = $model->where('subject','like',"%{$keywords}%")->where('state','>','0')->paginate(2);		} else {			$records = $model->where('state','>','0')->paginate(5);		}		$this->assign(['records' => $records, 'keywords' => $keywords]);		return $this->fetch();		    }    /**     * 显示创建资源表单页.     */    public function create()    {    	$cateModel = new \app\admin\model\Category;    	$cate_records = $cateModel->getCategoryTree();		$part_records = \app\admin\model\Partner::all();		$this->assign('cate_records',$cate_records);		$this->assign('part_records',$part_records);        return $this->fetch();    }    /**     * 保存新建的资源     *     * @param  \think\Request  $request     * @return \think\Response     */    public function save(Request $request)	{		$data = $request->post();		$data['addtime'] = time();		$data['admin_id'] = session('admin.id');		//处理上传图片		if ($request->file('thumb')) {			$file = $request->file('thumb')->move(ROOT_PATH . 'public/static/news_image');			$model = \think\Image::open($file->getPathName());			$model->thumb('150', '150')->save($file->getPathName());			$data['thumb'] = $file->getSaveName();		}		$model = new NewsModel;		$sucess = $model->save($data);		if($sucess){			return $this->success('新闻保存成功',url('admin/news/index'));		}else{			return $this->error('新闻保存失败,请重试',url('admin/news/create'));		}		    }    /**     * 显示新闻详情     */    public function read($id)    {        $record = NewsModel::get($id);		$this->assign('record',$record);		return $this->fetch();    }    /**     * 显示新闻编辑表单页.     */    public function edit($id)    {        $new_record = NewsModel::get($id);		$cateModel = new \app\admin\model\Category;		$cate_records = $cateModel->getCategoryTree();		$part_records = \app\admin\model\Partner::all();		$this->assign('new_record',$new_record);		$this->assign('cate_records',$cate_records);		$this->assign('part_records',$part_records);		return $this->fetch();    }    /**     * 保存更新的资源     */    public function update(Request $request, $id)    {        $data = $request->except('_method,id');		$data['addtime'] = time();		    	//处理上传图片		if (!empty($request->file('thumb'))) {			$file = $request->file('thumb')->move(ROOT_PATH . '/public/static/news_image/thumb');			$model = \think\Image::open($file->getPathName());			$model->thumb('150','150')->save($file->getPathName());			$data['thumb'] = $file->getSaveName();		}//		print_r($data);exit;		$model = new NewsModel;		$sucess = $model->update($data,['id'=>$id]);		if($sucess){			return $this->success('新闻更新成功',url('admin/news/index'));		}else{			return $this->error('新闻更新失败,请重试',url('admin/news/edit/'.$id));		}    }		/**     * 移动指定资源到回收站     */    public function move($id)    {    	$result = NewsModel::where('id','=',$id)->update(['state'=>0]);		if($result){			return $this->success('新闻删除成功',url('admin/news/index'));		}else{			return $this->error('新闻删除失败,请重试',url('admin/news/index'));		}	}		/**     * 新闻回收站     */    public function recycle(Request $request)    {		$keywords = $request->get('keywords');		$model = new NewsModel;		if ($keywords) {			$records = $model->where('subject','like',"%{$keywords}%")->where('state','=','0')->paginate(2);		} else {			$records = $model->where('state','=','0')->paginate(5);		}		$this->assign(['records' => $records, 'keywords' => $keywords]);		return $this->fetch();	}	/**	 * 还原回收站新闻	 */	public function restore($id)    {    	$result = NewsModel::where('id','=',$id)->update(['state'=>1]);		if($result){			return $this->success('新闻还原成功',url('admin/news/index'));		}else{			return $this->error('新闻还原失败,请重试',url('admin/news/recycle'));		}	}	    /**     * 清除回收站新闻     */    public function delete($id)    {        $model = new NewsModel;		$result = $model->where('id','=',$id)->delete();		if($result){			return $this->success('新闻删除成功',url('admin/news/index'));		}else{			return $this->error('新闻删除失败,请重试',url('admin/news/index'));    	}	}		/**     * 新闻发表     */    public function checked(Request $request)    {    	$id = $request->post('id');		$model = NewsModel::get($id);		$model->is_checked = 1;		$model->save();	 	return $id;	}		/**     * 取消新闻发表     */    public function unchecked(Request $request)    {    	$id = $request->post('id');		$model = NewsModel::get($id);		$model->is_checked = 0;		$model->save();	 	return $id;	}}